#!/bin/bash
#
# AUTOKPICTL
#
# Used to control the Automation API
#
# Dependencies: apachectl
#
# Created: 12/05/2018
# Updated: 12/05/2018
#     Updated to use httpk commands instead of systemctl
#
# Authors: Papa Nii Vanderpuuye
#


if [ "$1" == "-h" ]; then
	usage=$0' 	[-h]
		[status|stop|start|restart|graceful|graceful-stop|configtest]

	Options:
		-h 	: show help text'
	echo  "$usage"
else
	ACMD="$1"

	case $ACMD in
	status)
		/usr/bin/systemctl $ACMD httpd.service
		;;
	stop)
		httpd -k stop
        uwsgi --stop /tmp/autokpi-api.pid
		;;
	start)
		httpd -k start
        uwsgi --ini /app/platform/autokpi/app/etc/autokpi-api.ini --pidfile /tmp/autokpi-api.pid
		;;
	restart)
		uwsgi --stop /tmp/autokpi-api.pid
		httpd -k restart
        uwsgi --ini /app/platform/autokpi/app/etc/autokpi-api.ini --pidfile /tmp/autokpi-api.pid
		;;
	graceful)
		httpd -k graceful
        uwsgi --stop /tmp/autokpi-api.pid
        uwsgi --ini /app/platform/autokpi/app/etc/autokpi-api.ini --pidfile /tmp/autokpi-api.pid
		ERROR=$?
		;;
	graceful-stop)
		httpd -k graceful-stop
        uwsgi --stop /tmp/autokpi-api.pid
		ERROR=$?
		;;
	configtest)
		apachectl testconfig
		;;
	esac
fi
